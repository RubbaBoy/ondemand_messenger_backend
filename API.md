# API

All methods are POST. If anything has an error that occurs, it will return something like:

```json
{
    "error": "Some message here"
}
```

With a relevant response code.

## Keys

Every API endpoint requires either a `captchaToken` or `captchaOverride` JSON body element. The former is the response provided by [Google's reCaptcha](https://developers.google.com/recaptcha/docs/invisible). The latter is an alternative, which is a simple API key generated by the endpoint `/requestCaptchaOverride`. This requires a secret password and is only available to the site admin (me), so if you would like to use the production `ondemand.yarr.is` API, contact me at `RubbaBoy#2832` or email me at [adam@yarr.is](mailto:adam@yarr.is), or make an issue suggesting a way to distribute keys.

### `POST` /sendSMS

#### Request

```json
{
    "number": "1234567890",
    "message": "Any text"
}
```

The `number` must be a 10-digit phone number (or more if you include the country code). All non-numeric characters are stripped before processing. `message` may be anything your heart desires (granted your heart desires nothing more than 2^12 characters).

#### Response

```json
{"id": "uuid"}
```

The UUID given by OnDemand when a text was successfully sent.

### `POST` /requestToken

Requests a book token with given a book username/password. Tokens are stored and valid for 24 hours (or until the server restarts), and are sent instead of credentials during each book request.

#### Request

```json
{
    "name": "Book name",
    "password": "Book password"
}
```

#### Response

```json
{}
```

##### Headers

```
x-token: 32-char-token-here
```

The response will be empty, except for the `x-token` header which should be stored client-side, as it is the token.

### `POST` /requestCaptchaOverride

**RESTRICTED** Requests a token to override the reCaptcha present in the client website. Takes in a static password, used for administration purposes.

#### Request

```json
{
    "password": "The static secret admin password",
    "label": "The internal label for the key"
}
```

#### Response

```json
{
    "id": 0,
    "label": "Test",
    "token": "Token"
}
```

The `id` is the key's generated unique ID, as uniqueness is not derived from the label. The `token` returned is the string you put in any request with `captchaOverride` in any request instead of a reCaptcha token.

### `POST` /createBook

Creates an address book with credentials.

```json
{
    "name": "Book name",
    "password": "The password"
}
```

#### Response

```json
{
    "book": {
        "id": "1",
        "name": "Book name"
    }
}
```

##### Headers

```
x-token: 32-char-token-here
```

The `x-token` header should be stored client-side, as it is the book's token which should be sent over every book-related request.


### `POST` /getBook

Gets a book by credentials.

```json
{
    "name": "Book name",
    "password": "The password"
}
```

#### Response

```json
{
    "numbers": [
        {
            "numberId": "1",
            "name": "Person name",
            "number": "1234567890"
        }
    ]
}
```

The `numbers` object is an array of numbers from the book. The `numberId` is the identifier used for things like deleting, as names are not unique.

### `POST` /addNumber

Adds a phone number to the address book.

```json
{
    "name": "Book name",
    "password": "The password",
    "numberName": "Person name",
    "number": "1234567890"
}
```

#### Response

```json
{
    "number": {
        "numberId": "1",
        "name": "Person name",
        "number": "1234567890"
    }
}
```

Returns a number object in `number`.

### `POST` /removeNumber

```json
{
    "name": "Book name",
    "password": "The password",
    "numberId": "1"
}
```

#### Response

```json
{}
```

